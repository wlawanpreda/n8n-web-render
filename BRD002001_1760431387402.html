<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wireframe: Product Review System</title>
    <style>
        /* CSS Style Guide Implementation */
        :root {
            /* Global Variables */
            --font-family-base: Kanit, Sarabun, 'Segoe UI', Tahoma, sans-serif;
            --border-radius-base: 8px;
            --border-radius-small: 4px;
            --spacing-unit: 4px;
            --transition-base: all 0.3s ease;

            /* Color Palette */
            --color-brand-primary: #ED1C24;
            --color-brand-primary-hover: #D41920;
            --color-background-gray: #F2F3F5;
            --color-background-white: #FFFFFF;
            --color-background-light-pink: #FBEAEA;
            --color-text-main: #343A40;
            --color-text-secondary: #6C757D;
            --color-text-light: #999999;
            --color-border-light: #E0E0E0;
            --color-star-yellow: #FFC107;
            --color-success-green: #28a745;
        }

        /* Base & Typography */
        body {
            font-family: var(--font-family-base);
            background-color: var(--color-background-gray);
            color: var(--color-text-main);
            margin: 0;
            font-size: 16px;
            line-height: 1.6;
        }

        h1, h2, h3 { margin: 0; }
        h1 { font-size: 2rem; font-weight: 700; line-height: 1.3; margin-bottom: 24px; }
        h2 { font-size: 1.5rem; font-weight: 600; line-height: 1.4; margin-bottom: 16px; }
        h3 { font-size: 1.125rem; font-weight: 500; line-height: 1.5; margin-bottom: 8px; }

        p { margin: 0 0 16px; }
        small { font-size: 0.875rem; color: var(--color-text-secondary); }

        /* Layout */
        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 24px;
        }
        .hidden { display: none !important; }

        /* View Switcher Navigation */
        .view-switcher {
            background-color: var(--color-text-main);
            padding: 12px 24px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .view-switcher button {
            background-color: var(--color-background-gray);
            border: 1px solid var(--color-text-secondary);
            color: var(--color-text-main);
            padding: 8px 16px;
            margin: 0 8px;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            font-family: var(--font-family-base);
            font-weight: 500;
            transition: var(--transition-base);
        }
        .view-switcher button:hover, .view-switcher button.active {
            background-color: var(--color-brand-primary);
            color: var(--color-background-white);
            border-color: var(--color-brand-primary);
        }

        /* Card Component */
        .card {
            background-color: var(--color-background-white);
            border-radius: var(--border-radius-base);
            border: 1px solid var(--color-border-light);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        /* Button Components */
        .btn {
            font-family: var(--font-family-base);
            border: none;
            border-radius: var(--border-radius-small);
            padding: 10px 24px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-base);
            text-align: center;
            display: inline-block;
        }
        .btn-primary {
            background-color: var(--color-brand-primary);
            color: var(--color-background-white);
        }
        .btn-primary:hover {
            background-color: var(--color-brand-primary-hover);
        }
        .btn-secondary {
            background-color: transparent;
            color: var(--color-text-secondary);
            border: 1px solid var(--color-border-light);
        }
        .btn-secondary:hover {
            background-color: var(--color-background-gray);
            border-color: var(--color-text-secondary);
        }
        .btn-sm { padding: 6px 12px; font-size: 0.875rem; }
        .btn-link {
            background: none;
            border: none;
            color: var(--color-brand-primary);
            cursor: pointer;
            padding: 0;
            font-size: 0.875rem;
            text-decoration: underline;
        }
        .btn-link:hover { color: var(--color-brand-primary-hover); }

        /* Star Rating Display */
        .star-rating { display: flex; align-items: center; gap: 4px; }
        .star-rating .star { color: var(--color-star-yellow); font-size: 1.25em; }
        .star-rating .star.empty { color: var(--color-border-light); }

        /* Review Summary Section */
        .review-summary { display: grid; grid-template-columns: auto 1fr; gap: 24px; align-items: center; }
        .review-summary-score { text-align: center; }
        .review-summary-score .score-value { font-size: 3rem; font-weight: 700; color: var(--color-text-main); }
        .review-summary-score .score-total { font-size: 1rem; color: var(--color-text-secondary); }
        .review-summary-bars .bar-row { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
        .review-summary-bars .bar-label { font-size: 0.875rem; width: 50px; }
        .review-summary-bars .bar-container { flex-grow: 1; background-color: var(--color-background-gray); border-radius: 100px; height: 8px; overflow: hidden;}
        .review-summary-bars .bar-fill { background-color: var(--color-star-yellow); height: 100%; border-radius: 100px; }

        /* Review List Section */
        .review-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .review-card { border-bottom: 1px solid var(--color-border-light); padding: 16px 0; }
        .review-card:last-child { border-bottom: none; }
        .review-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
        .review-author { font-weight: 600; }
        .review-meta { display: flex; align-items: center; gap: 16px; }
        .review-body p { margin-bottom: 12px; }
        .review-images { display: flex; gap: 8px; margin-bottom: 12px; }
        .review-images .img-placeholder { width: 80px; height: 80px; background-color: #ccc; border-radius: var(--border-radius-small); }
        .merchant-reply {
            background-color: var(--color-background-light-pink);
            border-left: 4px solid var(--color-brand-primary);
            padding: 12px;
            margin-top: 12px;
            border-radius: var(--border-radius-small);
        }
        .merchant-reply-header { font-weight: 600; color: var(--color-text-main); }
        .review-actions { text-align: right; }

        /* Modal */
        .modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: var(--color-background-white);
            padding: 24px;
            border-radius: var(--border-radius-base);
            width: 90%;
            max-width: 500px;
            position: relative;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        .modal.active .modal-content {
            transform: translateY(0);
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .modal-close { font-size: 1.5rem; cursor: pointer; color: var(--color-text-secondary); background: none; border: none; }
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-weight: 500; margin-bottom: 6px; font-size: 0.875rem; }
        .form-input, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-border-light);
            border-radius: var(--border-radius-small);
            font-size: 1rem;
            font-family: var(--font-family-base);
            transition: var(--transition-base);
            box-sizing: border-box;
        }
        .form-input:focus, .form-textarea:focus {
            border-color: var(--color-brand-primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(237, 28, 36, 0.2);
        }
        .form-textarea { resize: vertical; min-height: 100px; }
        .char-counter { font-size: 0.75rem; color: var(--color-text-light); text-align: right; }
        .star-rating-input .star { font-size: 2rem; color: var(--color-border-light); cursor: pointer; transition: color 0.2s; }
        .star-rating-input .star:hover, .star-rating-input .star.selected { color: var(--color-star-yellow); }
        .modal-footer { display: flex; justify-content: flex-end; gap: 8px; margin-top: 24px; }

        /* Backend Layout */
        .backend-layout { display: flex; height: 100vh; }
        .sidebar {
            width: 240px;
            background-color: var(--color-background-white);
            border-right: 1px solid var(--color-border-light);
            padding: 24px;
            flex-shrink: 0;
            box-sizing: border-box;
        }
        .sidebar h2 { font-size: 1.25rem; }
        .sidebar-nav { list-style: none; padding: 0; margin: 24px 0 0; }
        .sidebar-nav li a {
            display: block;
            padding: 12px 16px;
            text-decoration: none;
            color: var(--color-text-secondary);
            border-radius: var(--border-radius-base);
            font-weight: 500;
            transition: var(--transition-base);
        }
        .sidebar-nav li a:hover, .sidebar-nav li a.active {
            background-color: var(--color-background-light-pink);
            color: var(--color-brand-primary);
        }
        .main-content {
            flex-grow: 1;
            padding: 24px;
            overflow-y: auto;
        }
        .page-header {
            background-color: var(--color-background-white);
            padding: 20px 24px;
            border-radius: var(--border-radius-base);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Merchant Dashboard */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;}
        .stat-card { background-color: var(--color-background-white); padding: 16px; border-radius: var(--border-radius-base); border: 1px solid var(--color-border-light); }
        .stat-card-title { font-size: 0.875rem; color: var(--color-text-secondary); }
        .stat-card-value { font-size: 2rem; font-weight: 700; color: var(--color-text-main); }

        /* Review Table (Backend) */
        .review-table { width: 100%; border-collapse: collapse; background-color: var(--color-background-white); }
        .review-table th, .review-table td { padding: 12px 16px; text-align: left; border-bottom: 1px solid var(--color-border-light); }
        .review-table th { font-weight: 600; font-size: 0.875rem; color: var(--color-text-secondary); background-color: var(--color-background-gray); }
        .review-table td .review-text-preview {
            max-width: 300px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .btn-approve { background-color: var(--color-success-green); color: white; }
        .btn-approve:hover { background-color: #218838; }
        .btn-delete { background-color: var(--color-brand-primary); color: white; }
        .btn-delete:hover { background-color: var(--color-brand-primary-hover); }

        /* Notifications */
        #notifications-container { position: fixed; bottom: 20px; right: 20px; z-index: 3000; }
        .notification {
            background-color: var(--color-text-main);
            color: var(--color-background-white);
            padding: 16px;
            border-radius: var(--border-radius-base);
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.5s ease;
        }
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
    </style>
</head>
<body>

    <header class="view-switcher">
        <strong>Wireframe User Flow:</strong>
        <button id="show-customer" class="active">ลูกค้า (Customer)</button>
        <button id="show-merchant">ร้านค้า (Merchant)</button>
        <button id="show-admin">ผู้ดูแล (Admin)</button>
    </header>

    <div id="customer-view">
        <div class="container">
            <h1>รายละเอียดสินค้า: Super Widget 5000</h1>
            <div class="card">
                <h2>สรุปคะแนนรีวิว</h2>
                <div class="review-summary">
                    <div class="review-summary-score">
                        <div class="score-value">4.5</div>
                        <div class="star-rating">
                            <span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star empty">☆</span>
                        </div>
                        <small>จาก 2 รีวิว</small>
                    </div>
                    <div class="review-summary-bars">
                        <div class="bar-row"><div class="bar-label">5 ดาว</div><div class="bar-container"><div class="bar-fill" style="width: 50%;"></div></div></div>
                        <div class="bar-row"><div class="bar-label">4 ดาว</div><div class="bar-container"><div class="bar-fill" style="width: 50%;"></div></div></div>
                        <div class="bar-row"><div class="bar-label">3 ดาว</div><div class="bar-container"><div class="bar-fill" style="width: 0%;"></div></div></div>
                        <div class="bar-row"><div class="bar-label">2 ดาว</div><div class="bar-container"><div class="bar-fill" style="width: 0%;"></div></div></div>
                        <div class="bar-row"><div class="bar-label">1 ดาว</div><div class="bar-container"><div class="bar-fill" style="width: 0%;"></div></div></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="review-controls">
                    <h2>รีวิวทั้งหมด (2)</h2>
                    <button id="write-review-btn" class="btn btn-primary">เขียนรีวิว</button>
                </div>
                <div id="review-list">
                    <div class="review-card" id="review-1">
                        <div class="review-header">
                            <div class="review-author">สมชาย ใจดี</div>
                            <div class="review-meta">
                                <div class="star-rating">
                                    <span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span>
                                </div>
                                <small>15/07/2024</small>
                            </div>
                        </div>
                        <div class="review-body">
                            <p>สินค้าดีมากครับ จัดส่งรวดเร็วทันใจ วัสดุแข็งแรงทนทาน ประทับใจมากครับ!</p>
                            <div class="review-images">
                                <div class="img-placeholder"></div>
                                <div class="img-placeholder"></div>
                            </div>
                        </div>
                        <div class="merchant-reply-container">
                           <!-- Merchant replies go here -->
                        </div>
                        <div class="review-actions">
                             <button class="btn-link" onclick="alert('จำลองการแก้ไขรีวิว')">แก้ไข</button>
                             <button class="btn-link" onclick="alert('จำลองการลบรีวิว')">ลบ</button>
                        </div>
                    </div>
                    <div class="review-card" id="review-2">
                        <div class="review-header">
                            <div class="review-author">มานี มีสุข</div>
                             <div class="review-meta">
                                <div class="star-rating">
                                    <span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star">★</span><span class="star empty">☆</span>
                                </div>
                                <small>14/07/2024</small>
                            </div>
                        </div>
                        <div class="review-body">
                            <p>คุณภาพสมราคา แต่รอนานไปหน่อย โดยรวมโอเคค่ะ</p>
                        </div>
                        <div class="merchant-reply-container">
                            <div class="merchant-reply">
                                <div class="merchant-reply-header">คำตอบจากร้านค้า:</div>
                                <p>ขอบคุณสำหรับรีวิวครับ ทางร้านจะนำไปปรับปรุงเรื่องการจัดส่งให้ดียิ่งขึ้นครับ</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="merchant-view" class="hidden">
        <div class="backend-layout">
            <aside class="sidebar">
                <h2>Merchant</h2>
                <ul class="sidebar-nav">
                    <li><a href="#" class="active">จัดการรีวิว</a></li>
                    <li><a href="#">สินค้าของฉัน</a></li>
                    <li><a href="#">ตั้งค่าร้านค้า</a></li>
                </ul>
            </aside>
            <main class="main-content">
                <div class="page-header">
                    <h1>Dashboard จัดการรีวิว</h1>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-title">คะแนนเฉลี่ยรวม</div>
                        <div class="stat-card-value">4.5</div>
                    </div>
                     <div class="stat-card">
                        <div class="stat-card-title">รีวิวใหม่</div>
                        <div class="stat-card-value">1</div>
                    </div>
                     <div class="stat-card">
                        <div class="stat-card-title">รีวิวที่ยังไม่ตอบ</div>
                        <div class="stat-card-value">1</div>
                    </div>
                </div>

                <div class="card">
                     <h2>รายการรีวิวทั้งหมด</h2>
                     <table class="review-table">
                        <thead>
                            <tr>
                                <th>สินค้า</th>
                                <th>คะแนน</th>
                                <th>รีวิว</th>
                                <th>วันที่</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="merchant-review-list">
                             <tr data-review-id="review-1">
                                <td>Super Widget 5000</td>
                                <td>5/5</td>
                                <td><div class="review-text-preview">สินค้าดีมากครับ จัดส่งรวดเร็ว...</div></td>
                                <td>15/07/2024</td>
                                <td><button class="btn btn-secondary btn-sm reply-btn">ตอบกลับ</button></td>
                            </tr>
                            <tr data-review-id="review-2">
                                <td>Super Widget 5000</td>
                                <td>4/5</td>
                                <td><div class="review-text-preview">คุณภาพสมราคา แต่รอนานไปหน่อย...</div></td>
                                <td>14/07/2024</td>
                                <td><button class="btn btn-secondary btn-sm" disabled>ตอบแล้ว</button></td>
                            </tr>
                        </tbody>
                     </table>
                </div>
            </main>
        </div>
    </div>

    <div id="admin-view" class="hidden">
        <div class="backend-layout">
            <aside class="sidebar">
                <h2>Admin</h2>
                <ul class="sidebar-nav">
                    <li><a href="#" class="active">รีวิวที่ไม่เหมาะสม</a></li>
                    <li><a href="#">จัดการผู้ใช้</a></li>
                    <li><a href="#">ตั้งค่าระบบ</a></li>
                </ul>
            </aside>
            <main class="main-content">
                <div class="page-header">
                    <h1>จัดการรีวิวที่ไม่เหมาะสม</h1>
                </div>

                <div class="card">
                    <h2>รายการรีวิวที่ถูกรายงาน</h2>
                    <table class="review-table">
                        <thead>
                            <tr>
                                <th>ผู้รีวิว</th>
                                <th>เนื้อหารีวิว</th>
                                <th>เหตุผลที่ถูก Flag</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="flagged-review-list">
                            <tr id="flagged-1">
                                <td>ผู้ใช้ที่ไม่เหมาะสม</td>
                                <td>แย่มาก มีคำหยาบ...</td>
                                <td>ตรวจพบคำไม่เหมาะสม</td>
                                <td>
                                    <button class="btn btn-sm btn-approve" onclick="approveReview('flagged-1')">อนุมัติ</button>
                                    <button class="btn btn-sm btn-delete" onclick="deleteReview('flagged-1')">ลบรีวิว</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="review-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>เขียนรีวิวของคุณ</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="review-form">
                    <div class="form-group">
                        <label class="form-label">ให้คะแนนสินค้า</label>
                        <div class="star-rating-input" data-rating="0">
                            <span class="star" data-value="1">☆</span>
                            <span class="star" data-value="2">☆</span>
                            <span class="star" data-value="3">☆</span>
                            <span class="star" data-value="4">☆</span>
                            <span class="star" data-value="5">☆</span>
                        </div>
                        <input type="hidden" name="rating" id="rating-value" value="0">
                    </div>
                    <div class="form-group">
                        <label for="review-text" class="form-label">เขียนรีวิว</label>
                        <textarea id="review-text" class="form-textarea" placeholder="บอกเล่าประสบการณ์ของคุณ..." maxlength="500"></textarea>
                        <div class="char-counter"><span id="char-count">0</span> / 500</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">อัปโหลดรูปภาพ (สูงสุด 3 รูป)</label>
                        <button type="button" class="btn btn-secondary">เลือกไฟล์</button>
                        <div class="review-images" style="margin-top: 10px;">
                            <!-- Placeholders for uploaded images -->
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-cancel">ยกเลิก</button>
                <button id="submit-review" type="button" class="btn btn-primary">ส่งรีวิว</button>
            </div>
        </div>
    </div>
    
    <div id="reply-modal" class="modal">
         <div class="modal-content">
            <div class="modal-header">
                <h3>ตอบกลับรีวิว</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="reply-form">
                    <input type="hidden" id="reply-review-id" value="">
                    <div class="form-group">
                        <label for="reply-text" class="form-label">ข้อความตอบกลับ</label>
                        <textarea id="reply-text" class="form-textarea" placeholder="เขียนคำตอบของคุณ..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-cancel">ยกเลิก</button>
                <button id="submit-reply" type="button" class="btn btn-primary">ส่งคำตอบ</button>
            </div>
        </div>
    </div>
    
    <div id="notifications-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const views = {
                customer: document.getElementById('customer-view'),
                merchant: document.getElementById('merchant-view'),
                admin: document.getElementById('admin-view'),
            };
            const buttons = {
                customer: document.getElementById('show-customer'),
                merchant: document.getElementById('show-merchant'),
                admin: document.getElementById('show-admin'),
            };
            const reviewModal = document.getElementById('review-modal');
            const replyModal = document.getElementById('reply-modal');
            
            // --- View Switching ---
            function switchView(targetView) {
                Object.values(views).forEach(view => view.classList.add('hidden'));
                Object.values(buttons).forEach(button => button.classList.remove('active'));
                
                views[targetView].classList.remove('hidden');
                buttons[targetView].classList.add('active');
            }
            
            buttons.customer.addEventListener('click', () => switchView('customer'));
            buttons.merchant.addEventListener('click', () => switchView('merchant'));
            buttons.admin.addEventListener('click', () => switchView('admin'));

            // --- Modal Handling ---
            function openModal(modal) {
                modal.classList.add('active');
            }

            function closeModal(modal) {
                modal.classList.remove('active');
            }
            
            document.getElementById('write-review-btn').addEventListener('click', () => openModal(reviewModal));
            
            reviewModal.querySelector('.modal-close').addEventListener('click', () => closeModal(reviewModal));
            reviewModal.querySelector('.modal-cancel').addEventListener('click', () => closeModal(reviewModal));
            
            replyModal.querySelector('.modal-close').addEventListener('click', () => closeModal(replyModal));
            replyModal.querySelector('.modal-cancel').addEventListener('click', () => closeModal(replyModal));

            // --- Star Rating Input ---
            const starRatingInput = document.querySelector('.star-rating-input');
            const stars = starRatingInput.querySelectorAll('.star');
            
            stars.forEach(star => {
                star.addEventListener('mouseover', function() {
                    const rating = this.dataset.value;
                    highlightStars(rating);
                });
                
                star.addEventListener('mouseleave', function() {
                    const currentRating = starRatingInput.dataset.rating;
                    highlightStars(currentRating);
                });

                star.addEventListener('click', function() {
                    const rating = this.dataset.value;
                    starRatingInput.dataset.rating = rating;
                    document.getElementById('rating-value').value = rating;
                    highlightStars(rating);
                });
            });

            function highlightStars(rating) {
                stars.forEach(star => {
                    star.classList.toggle('selected', star.dataset.value <= rating);
                    star.textContent = star.dataset.value <= rating ? '★' : '☆';
                });
            }

            // --- Character Counter ---
            const reviewTextArea = document.getElementById('review-text');
            const charCount = document.getElementById('char-count');
            reviewTextArea.addEventListener('input', function() {
                charCount.textContent = this.value.length;
            });

            // --- Submit New Review Flow ---
            document.getElementById('submit-review').addEventListener('click', function() {
                const rating = parseInt(document.getElementById('rating-value').value);
                const text = document.getElementById('review-text').value;

                if (rating === 0 || text.trim() === '') {
                    alert('กรุณาให้คะแนนและเขียนรีวิว');
                    return;
                }

                const newReviewId = 'review-' + Date.now();
                const newReviewHTML = `
                    <div class="review-card" id="${newReviewId}">
                        <div class="review-header">
                            <div class="review-author">คุณ (ผู้ซื้อ)</div>
                            <div class="review-meta">
                                <div class="star-rating">
                                    ${'★'.repeat(rating)}${'☆'.repeat(5 - rating)}
                                </div>
                                <small>เมื่อสักครู่</small>
                            </div>
                        </div>
                        <div class="review-body">
                            <p>${text.replace(/\n/g, '<br>')}</p>
                        </div>
                        <div class="merchant-reply-container"></div>
                        <div class="review-actions">
                             <button class="btn-link">แก้ไข</button>
                             <button class="btn-link">ลบ</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('review-list').insertAdjacentHTML('afterbegin', newReviewHTML);
                addReviewToMerchantList(newReviewId, rating, text);
                
                closeModal(reviewModal);
                document.getElementById('review-form').reset();
                highlightStars(0);
                charCount.textContent = 0;
                
                showNotification('รีวิวใหม่จากลูกค้า!', 'merchant');
            });

            function addReviewToMerchantList(id, rating, text) {
                const newRowHTML = `
                     <tr data-review-id="${id}">
                        <td>Super Widget 5000</td>
                        <td>${rating}/5</td>
                        <td><div class="review-text-preview">${text}</div></td>
                        <td>เมื่อสักครู่</td>
                        <td><button class="btn btn-secondary btn-sm reply-btn">ตอบกลับ</button></td>
                    </tr>
                `;
                document.getElementById('merchant-review-list').insertAdjacentHTML('afterbegin', newRowHTML);
            }

            // --- Merchant Reply Flow ---
            document.getElementById('merchant-review-list').addEventListener('click', function(e) {
                if (e.target.classList.contains('reply-btn')) {
                    const reviewRow = e.target.closest('tr');
                    const reviewId = reviewRow.dataset.reviewId;
                    document.getElementById('reply-review-id').value = reviewId;
                    openModal(replyModal);
                }
            });

            document.getElementById('submit-reply').addEventListener('click', function() {
                const reviewId = document.getElementById('reply-review-id').value;
                const replyText = document.getElementById('reply-text').value;
                
                if (replyText.trim() === '') {
                    alert('กรุณาพิมพ์ข้อความตอบกลับ');
                    return;
                }
                
                const replyHTML = `
                    <div class="merchant-reply">
                        <div class="merchant-reply-header">คำตอบจากร้านค้า:</div>
                        <p>${replyText.replace(/\n/g, '<br>')}</p>
                    </div>`;

                const targetContainer = document.querySelector(`#${reviewId} .merchant-reply-container`);
                if(targetContainer){
                    targetContainer.innerHTML = replyHTML;
                }

                const merchantRow = document.querySelector(`#merchant-review-list tr[data-review-id="${reviewId}"]`);
                if(merchantRow){
                    const actionCell = merchantRow.querySelector('td:last-child');
                    actionCell.innerHTML = '<button class="btn btn-secondary btn-sm" disabled>ตอบแล้ว</button>';
                }

                closeModal(replyModal);
                document.getElementById('reply-form').reset();
                showNotification('ร้านค้าตอบกลับรีวิวของคุณ!', 'customer');
            });

            // --- Admin Flow ---
            window.approveReview = function(rowId) {
                const row = document.getElementById(rowId);
                row.style.backgroundColor = 'rgba(40, 167, 69, 0.1)';
                row.querySelector('td:last-child').innerHTML = '<em>อนุมัติแล้ว</em>';
                setTimeout(() => row.remove(), 1000);
            };

            window.deleteReview = function(rowId) {
                const row = document.getElementById(rowId);
                row.style.backgroundColor = 'rgba(237, 28, 36, 0.1)';
                 row.querySelector('td:last-child').innerHTML = '<em>ลบแล้ว</em>';
                setTimeout(() => row.remove(), 1000);
            };
            
            // --- Notification System ---
            function showNotification(message, targetUser) {
                const container = document.getElementById('notifications-container');
                const notif = document.createElement('div');
                notif.className = 'notification';
                notif.textContent = `[${targetUser.toUpperCase()}] ${message}`;
                container.appendChild(notif);
                
                setTimeout(() => {
                    notif.classList.add('show');
                }, 10);
                
                setTimeout(() => {
                    notif.classList.remove('show');
                    setTimeout(() => {
                        notif.remove();
                    }, 500);
                }, 4000);
            }

        });
    </script>
</body>
</html>
